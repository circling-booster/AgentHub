# Claude Code 서브에이전트 활용 가이드

이 문서는 FHLY 프로젝트 개발 시 Claude Code의 서브에이전트(Task 도구)를 효과적으로 활용하는 방법을 설명합니다.

## 개요

Claude Code는 복잡한 작업을 처리하기 위해 전문화된 서브에이전트를 제공합니다. 이 에이전트들은 Task 도구를 통해 호출되며, 각각 특정 목적에 최적화되어 있습니다.

## 기본 제공 서브에이전트

### Explore Agent
**목적:** 코드베이스 탐색 및 조사

**사용 시나리오:**
- 특정 기능이 어디에 구현되어 있는지 찾을 때
- 코드베이스 구조를 파악할 때
- 키워드나 패턴을 검색할 때

**예시 요청:**
```
"MCP 서버 연결 코드가 어디에 있는지 찾아줘"
"에러 핸들링이 어떻게 구현되어 있는지 조사해줘"
"API 엔드포인트들의 위치를 파악해줘"
```

**특징:**
- 읽기 전용 (코드 수정 불가)
- Glob, Grep, Read 도구 사용
- 빠른 탐색에 최적화

---

### Plan Agent
**목적:** 구현 전략 설계 및 계획 수립

**사용 시나리오:**
- 새 기능 구현 전 계획을 세울 때
- 리팩토링 전략을 수립할 때
- 아키텍처 결정이 필요할 때

**예시 요청:**
```
"MCP 서버 개발 계획을 세워줘"
"A2A 통합 구현 전략을 설계해줘"
"테스트 커버리지 개선 계획을 만들어줘"
```

**특징:**
- 읽기 전용 (코드 수정 불가)
- 단계별 계획 제시
- 트레이드오프 분석

---

### general-purpose Agent
**목적:** 복잡한 멀티스텝 작업 수행

**사용 시나리오:**
- 여러 단계가 필요한 복합 작업
- 코드 검색과 수정이 함께 필요한 작업
- 광범위한 조사가 필요한 질문

**예시 요청:**
```
"모든 TODO 주석을 찾아서 정리해줘"
"사용되지 않는 import를 찾아서 제거해줘"
"API 스키마 변경에 따른 영향 분석해줘"
```

**특징:**
- 모든 도구 사용 가능
- 자율적 작업 수행
- 복잡한 워크플로우 처리

---

### Bash Agent
**목적:** 명령어 실행 전문

**사용 시나리오:**
- Git 작업
- 패키지 설치/관리
- 빌드 및 테스트 실행

**예시 요청:**
```
"pytest 실행해줘"
"git log 확인해줘"
"dependencies 설치해줘"
```

---

## FHLY 프로젝트용 커스텀 에이전트 역할 정의

프로젝트의 `.claude/skills/`에 정의된 Skills와 함께, 다음과 같은 역할별 작업을 Task 도구에 위임할 수 있습니다.

### Code 역할
코드 생성, 수정, 리팩토링 작업

```
프롬프트 예시:
"src/mcp_server.py에 새로운 도구를 추가해줘.
도구 이름: search_documents
기능: 문서 검색"
```

### Test 역할
테스트 생성 및 실행

```
프롬프트 예시:
"src/utils/parser.py에 대한 단위 테스트를 작성해줘.
pytest 스타일로 작성하고, 엣지 케이스도 포함해줘."
```

### Review 역할
코드 리뷰 및 품질 분석

```
프롬프트 예시:
"최근 변경된 파일들을 리뷰해줘.
보안, 성능, 가독성 관점에서 검토해줘."
```

### Documentation 역할
문서 생성 및 업데이트

```
프롬프트 예시:
"src/fhly/agents/ 모듈에 대한 API 문서를 생성해줘.
각 클래스와 메서드의 설명을 포함해줘."
```

### MCP Dev 역할
MCP 서버 개발 지원

```
프롬프트 예시:
"FastMCP 기반 이미지 처리 MCP 서버의 기본 구조를 만들어줘.
도구: resize_image, convert_format"
```

### A2A 역할
A2A 프로토콜 관련 작업

```
프롬프트 예시:
"이 에이전트의 Agent Card JSON을 생성해줘.
A2A 프로토콜 스펙을 따라야 해."
```

---

## 효과적인 프롬프트 작성법

### 1. 명확한 컨텍스트 제공

```
나쁜 예: "코드 수정해줘"
좋은 예: "src/mcp/server.py의 handle_request 함수에서
        타임아웃 처리를 추가해줘. 기본값은 30초로 설정."
```

### 2. 기대 결과 명시

```
나쁜 예: "테스트 작성해줘"
좋은 예: "src/utils/validator.py에 대한 pytest 테스트를 작성해줘.
        - 정상 입력 케이스 3개
        - 예외 케이스 2개
        - 경계값 테스트 1개"
```

### 3. 제약 조건 포함

```
"기존 API와의 하위 호환성을 유지해야 해."
"Python 3.10+ 문법만 사용해줘."
"외부 의존성 추가 없이 구현해줘."
```

---

## 에이전트 조합 워크플로우

### 워크플로우 1: 새 기능 개발

```
1. Explore Agent: "관련 기존 코드 조사"
2. Plan Agent: "구현 계획 수립"
3. general-purpose Agent: "코드 구현"
4. general-purpose Agent: "테스트 작성"
5. Bash Agent: "테스트 실행 및 검증"
```

### 워크플로우 2: 버그 수정

```
1. Explore Agent: "버그 관련 코드 위치 파악"
2. general-purpose Agent: "원인 분석 및 수정"
3. Bash Agent: "테스트 실행"
```

### 워크플로우 3: MCP 서버 개발

```
1. Explore Agent: "기존 MCP 서버 구조 파악"
2. Plan Agent: "새 서버 설계"
3. general-purpose Agent: "서버 코드 생성"
4. Bash Agent: "서버 테스트 실행"
```

---

## 주의사항

1. **탐색 vs 구현 구분**: 단순 조사는 Explore Agent, 코드 수정이 필요하면 general-purpose Agent 사용

2. **병렬 실행 활용**: 독립적인 작업은 여러 에이전트를 동시에 호출 가능

3. **컨텍스트 공유**: 에이전트 간 결과를 명시적으로 전달해야 함

4. **백그라운드 실행**: 오래 걸리는 작업은 `run_in_background: true` 옵션 활용

---

## 참고 자료

- [Claude Code 공식 문서](https://docs.anthropic.com/claude-code)
- [FHLY Skills 가이드](skills-guide.md)
- [FHLY 아키텍처 문서](architecture-agents.md)
