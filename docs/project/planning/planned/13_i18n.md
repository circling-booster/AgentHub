# Plan 13: Internationalization (i18n) (Draft)

> **ìƒíƒœ:** ğŸ“‹ Draft
> **ì„ í–‰ ì¡°ê±´:** Plan 07 Complete (ê¸°ë³¸ ê¸°ëŠ¥ ì™„ì„±)
> **ëª©í‘œ:** Backend + Extension êµ­ì œí™” (Korean + English)

---

## Overview

**í•µì‹¬ ë¬¸ì œ:**
- í˜„ì¬: ëª¨ë“  ë©”ì‹œì§€ê°€ ì˜ì–´ë¡œ í•˜ë“œì½”ë”©
- í•„ìš”: ë‹¤êµ­ì–´ ì§€ì› (Korean, English)

**êµ¬í˜„ ë²”ìœ„:**
1. **Backend i18n**: ì—ëŸ¬ ë©”ì‹œì§€, ë¡œê·¸, API ì‘ë‹µ (i18next-like)
2. **Extension i18n**: UI í…ìŠ¤íŠ¸, ì•Œë¦¼ (react-i18next)
3. **Language Selection**: Playground + Extension Settings
4. **Fallback Strategy**: ë²ˆì—­ ëˆ„ë½ ì‹œ ì˜ì–´ í´ë°±
5. **Lazy Loading**: ë²ˆë“¤ í¬ê¸° ìµœì í™”

**ì°¸ê³  ë¬¸ì„œ:**
- ì•„ì¹´ì´ë¸Œ: `_archive/migration/20260204/plans/phase7/backup-20260203/phase7.0-original.md` (Step 13-14)

---

## Key Features

### 1. Backend i18n

**Domain Service:**
```python
class I18nService:
    """Backend êµ­ì œí™” ì„œë¹„ìŠ¤ (ìˆœìˆ˜ Python)"""

    def __init__(self, default_locale: str = "en"):
        self.current_locale = default_locale
        self.translations: dict[str, dict[str, str]] = {}

    def translate(self, key: str, **kwargs) -> str:
        """ë²ˆì—­ í‚¤ â†’ ë²ˆì—­ëœ ë¬¸ìì—´"""
        template = self.translations.get(self.current_locale, {}).get(key)
        if template is None:
            template = self.translations.get("en", {}).get(key, key)  # ì˜ì–´ í´ë°±
        return template.format(**kwargs)

    def set_locale(self, locale: str) -> None:
        """ì–¸ì–´ ì„¤ì • ë³€ê²½"""
        self.current_locale = locale
```

**ë²ˆì—­ íŒŒì¼ (YAML):**
```yaml
# src/locales/en.yaml
errors:
  tool_not_found: "Tool '{tool_name}' not found"
  mcp_connection_failed: "Failed to connect to MCP server: {endpoint}"

messages:
  conversation_started: "Conversation started"
  tool_invoked: "Tool '{tool_name}' invoked successfully"

# src/locales/ko.yaml
errors:
  tool_not_found: "ë„êµ¬ '{tool_name}'ì„(ë¥¼) ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
  mcp_connection_failed: "MCP ì„œë²„ì— ì—°ê²° ì‹¤íŒ¨: {endpoint}"

messages:
  conversation_started: "ëŒ€í™”ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤"
  tool_invoked: "ë„êµ¬ '{tool_name}'ì´(ê°€) ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤"
```

**ì‚¬ìš© ì˜ˆì‹œ:**
```python
# ê¸°ì¡´
raise ToolNotFoundError(f"Tool '{tool_name}' not found")

# i18n ì ìš©
raise ToolNotFoundError(i18n.translate("errors.tool_not_found", tool_name=tool_name))
```

### 2. Extension i18n (react-i18next)

**ì„¤ì • (`extension/lib/i18n.ts`):**
```typescript
import i18next from 'i18next';
import { initReactI18next } from 'react-i18next';

i18next
  .use(initReactI18next)
  .init({
    resources: {
      en: { translation: enTranslations },
      ko: { translation: koTranslations }
    },
    lng: 'en',
    fallbackLng: 'en',
    interpolation: { escapeValue: false }
  });

export default i18next;
```

**ë²ˆì—­ íŒŒì¼ (`extension/locales/en.json`):**
```json
{
  "sidebar": {
    "conversations": "Conversations",
    "tools": "Tools",
    "settings": "Settings"
  },
  "buttons": {
    "submit": "Submit",
    "cancel": "Cancel",
    "save": "Save"
  },
  "errors": {
    "network_error": "Network error occurred"
  }
}
```

**ë²ˆì—­ íŒŒì¼ (`extension/locales/ko.json`):**
```json
{
  "sidebar": {
    "conversations": "ëŒ€í™” ëª©ë¡",
    "tools": "ë„êµ¬",
    "settings": "ì„¤ì •"
  },
  "buttons": {
    "submit": "ì œì¶œ",
    "cancel": "ì·¨ì†Œ",
    "save": "ì €ì¥"
  },
  "errors": {
    "network_error": "ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤"
  }
}
```

**ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©:**
```tsx
import { useTranslation } from 'react-i18next';

function Sidebar() {
  const { t } = useTranslation();

  return (
    <nav>
      <a href="/conversations">{t('sidebar.conversations')}</a>
      <a href="/tools">{t('sidebar.tools')}</a>
      <a href="/settings">{t('sidebar.settings')}</a>
    </nav>
  );
}
```

### 3. Language Selection

**Playground UI (Settings íƒ­):**
```
Language / ì–¸ì–´:
  ( ) English
  (â—) í•œêµ­ì–´

[ Save ]
```

**Extension Settings:**
```
Language / ì–¸ì–´:
  [ í•œêµ­ì–´ v ]

[ Save ]
```

**Storage:**
- Backend: SQLite (`user_preferences` í…Œì´ë¸”)
- Extension: LocalStorage (`agenthub_locale`)

### 4. Fallback Strategy

**ë²ˆì—­ ëˆ„ë½ ì²˜ë¦¬:**
```python
# Backend
def translate(self, key: str, **kwargs) -> str:
    # 1. í˜„ì¬ ì–¸ì–´ì—ì„œ ê²€ìƒ‰
    template = self.translations.get(self.current_locale, {}).get(key)

    # 2. ì˜ì–´ í´ë°±
    if template is None:
        template = self.translations.get("en", {}).get(key)

    # 3. í‚¤ ê·¸ëŒ€ë¡œ ë°˜í™˜ (ê°œë°œ ì¤‘ í™•ì¸ìš©)
    if template is None:
        return f"[MISSING: {key}]"

    return template.format(**kwargs)
```

```typescript
// Extension (react-i18next ìë™ í´ë°±)
i18next.init({
  fallbackLng: 'en',  // í•œêµ­ì–´ ë²ˆì—­ ì—†ìœ¼ë©´ ì˜ì–´ ì‚¬ìš©
  missingKeyHandler: (lng, ns, key) => {
    console.warn(`Missing translation: ${key} (${lng})`);
  }
});
```

### 5. Lazy Loading (Extension)

**ë²ˆë“¤ í¬ê¸° ìµœì í™”:**
```typescript
// ì–¸ì–´ë³„ ë²ˆì—­ íŒŒì¼ ë™ì  ë¡œë“œ
const loadLanguage = async (lng: string) => {
  const translations = await import(`./locales/${lng}.json`);
  i18next.addResourceBundle(lng, 'translation', translations);
};

// ì‚¬ìš©ìê°€ ì–¸ì–´ ë³€ê²½ ì‹œì—ë§Œ ë¡œë“œ
await loadLanguage('ko');
i18next.changeLanguage('ko');
```

---

## Phases (Preliminary)

| Phase | ì„¤ëª… | Playground | Status |
|-------|------|------------|--------|
| **1** | Domain Entities (LocaleConfig, TranslationKey) | - | â¸ï¸ |
| **2** | Port Interface (I18nServicePort) | - | â¸ï¸ |
| **3** | Backend i18n Service (YAML ë¡œë”©, translate ë©”ì„œë“œ) | - | â¸ï¸ |
| **4** | Backend ë©”ì‹œì§€ i18n ì ìš© (ì—ëŸ¬, ë¡œê·¸, API ì‘ë‹µ) | - | â¸ï¸ |
| **5** | Extension i18n Setup (react-i18next, ë²ˆì—­ íŒŒì¼) | - | â¸ï¸ |
| **6** | Extension UI i18n ì ìš© (ëª¨ë“  ì»´í¬ë„ŒíŠ¸) | - | â¸ï¸ |
| **7** | Language Selection UI (Playground + Extension) | âœ… | â¸ï¸ |
| **8** | E2E Tests + Validation | âœ… | â¸ï¸ |

**Phase ìƒì„¸ëŠ” Plan ìŠ¹ì¸ í›„ ì‘ì„± ì˜ˆì •**

---

## Architecture

```
Backend
â”œâ”€ src/locales/
â”‚  â”œâ”€ en.yaml   # ì˜ì–´ ë²ˆì—­
â”‚  â””â”€ ko.yaml   # í•œêµ­ì–´ ë²ˆì—­
â”œâ”€ src/domain/services/i18n_service.py
â””â”€ src/config/i18n_loader.py

Extension
â”œâ”€ extension/locales/
â”‚  â”œâ”€ en.json   # ì˜ì–´ ë²ˆì—­
â”‚  â””â”€ ko.json   # í•œêµ­ì–´ ë²ˆì—­
â””â”€ extension/lib/i18n.ts
```

---

## Design Considerations

### Translation Key Naming

**ê·œì¹™:**
- **ë„ë©”ì¸ ê¸°ë°˜ ê³„ì¸µ**: `errors.tool_not_found`, `messages.conversation_started`
- **ì†Œë¬¸ì + ì–¸ë”ìŠ¤ì½”ì–´**: `tool_not_found` (NOT `toolNotFound`)
- **ì§§ê³  ëª…í™•í•˜ê²Œ**: `save` (NOT `save_button_text`)

**ì˜ˆì‹œ:**
```yaml
# Good
errors:
  tool_not_found: "..."
  mcp_connection_failed: "..."

# Bad
error_messages:
  error_when_tool_is_not_found_in_the_database: "..."
```

### Pluralization (ì¶”í›„ ê³ ë ¤)

**í˜„ì¬:** ë‹¨ìˆœ ë³€ìˆ˜ ì¹˜í™˜ë§Œ ì§€ì›
```yaml
tool_invoked: "Tool '{tool_name}' invoked successfully"
```

**ì¶”í›„:** ë³µìˆ˜í˜• ì§€ì› (i18next plurals)
```yaml
tool_invoked_one: "1 tool invoked"
tool_invoked_other: "{{count}} tools invoked"
```

### Date/Number Formatting (ì¶”í›„ ê³ ë ¤)

**í˜„ì¬:** ê¸°ë³¸ ë¬¸ìì—´ë§Œ
**ì¶”í›„:** ë‚ ì§œ/ìˆ«ì í¬ë§·íŒ… (locale-aware)
```python
# í•œêµ­ì–´: 2026ë…„ 2ì›” 7ì¼
# ì˜ì–´: February 7, 2026
```

---

## Testing Strategy

### Unit Tests

**Backend:**
- `test_i18n_service_translate` (í‚¤ â†’ ë²ˆì—­)
- `test_i18n_service_fallback` (ëˆ„ë½ëœ í‚¤ â†’ ì˜ì–´ í´ë°±)
- `test_i18n_service_set_locale` (ì–¸ì–´ ë³€ê²½)

**Extension:**
- `test_i18next_setup` (ì´ˆê¸°í™” ê²€ì¦)
- `test_useTranslation_hook` (ë²ˆì—­ í›… ë™ì‘)

### Integration Tests

**Backend:**
- `test_error_messages_i18n` (ì—ëŸ¬ ë©”ì‹œì§€ ë²ˆì—­)
- `test_api_response_i18n` (API ì‘ë‹µ ë²ˆì—­)

**Extension:**
- `test_component_i18n` (ëª¨ë“  ì»´í¬ë„ŒíŠ¸ ë²ˆì—­ ê²€ì¦)
- `test_language_switch` (ì–¸ì–´ ì „í™˜ â†’ UI ì—…ë°ì´íŠ¸)

### E2E Tests (Playwright)

**Playground:**
- `test_playground_language_switch` (Settings íƒ­ ì–¸ì–´ ë³€ê²½ â†’ UI ì—…ë°ì´íŠ¸)
- `test_playground_korean_error_messages` (í•œêµ­ì–´ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ)

**Extension:**
- `test_extension_language_switch`
- `test_extension_korean_sidebar`

---

## Translation Coverage

**Phase 4 (Backend):**
- [x] ì—ëŸ¬ ë©”ì‹œì§€ (~20ê°œ)
- [x] ë¡œê·¸ ë©”ì‹œì§€ (~10ê°œ)
- [x] API ì‘ë‹µ ë©”ì‹œì§€ (~15ê°œ)

**Phase 6 (Extension):**
- [x] Sidebar ë©”ë‰´ (~5ê°œ)
- [x] Buttons (~10ê°œ)
- [x] Form Labels (~20ê°œ)
- [x] Error Messages (~10ê°œ)
- [x] Notifications (~10ê°œ)

**ì´ ë²ˆì—­ í‚¤ ìˆ˜:** ~100ê°œ (ì˜ˆìƒ)

---

## Dependencies

**Python Packages:**
- `pyyaml` (YAML ë²ˆì—­ íŒŒì¼ ë¡œë”©, ê¸°ì¡´ ì˜ì¡´ì„±)
- ê¸°ì¡´: `pydantic`, `fastapi`

**Extension Packages:**
- `react-i18next` (~50KB gzipped)
- `i18next` (ê¸°ë³¸ í¬í•¨)

**Lazy Loading í›„ ë²ˆë“¤ í¬ê¸°:**
- ì´ˆê¸°: +10KB (i18next ì½”ì–´)
- ì–¸ì–´ ë¡œë“œ ì‹œ: +5KB per language

---

## Risks

| ìœ„í—˜ | ì‹¬ê°ë„ | ëŒ€ì‘ |
|------|:------:|------|
| react-i18next ë²ˆë“¤ í¬ê¸° | ğŸŸ¢ | Lazy loadingìœ¼ë¡œ ê²½ëŸ‰í™” (~10KB) |
| ë²ˆì—­ í’ˆì§ˆ | ğŸŸ¡ | ë„¤ì´í‹°ë¸Œ ìŠ¤í”¼ì»¤ ë¦¬ë·° (ì¶”í›„) |
| ë²ˆì—­ ëˆ„ë½ (ê°œë°œ ì¤‘) | ğŸŸ¢ | ì˜ì–´ í´ë°± + ê°œë°œ ëª¨ë“œ ê²½ê³  |
| ë³µìˆ˜í˜•/ë‚ ì§œ í¬ë§·íŒ… ë³µì¡ë„ | ğŸŸ¡ | Phase 1ì—ì„œëŠ” ì œì™¸, ì¶”í›„ ê³ ë ¤ |

---

## Definition of Done

### Functionality
- [ ] Backend i18n Service ë™ì‘ (translate, set_locale)
- [ ] Backend ì—ëŸ¬/ë¡œê·¸/API ë©”ì‹œì§€ ë²ˆì—­ ì ìš©
- [ ] Extension react-i18next ì„¤ì • ì™„ë£Œ
- [ ] Extension ëª¨ë“  ì»´í¬ë„ŒíŠ¸ ë²ˆì—­ ì ìš©
- [ ] Playground Language Selection UI ë™ì‘
- [ ] Extension Language Selection UI ë™ì‘
- [ ] Korean + English ë²ˆì—­ ì™„ë£Œ (~100ê°œ í‚¤)

### Quality
- [ ] Backend coverage >= 80%
- [ ] Extension ë²ˆì—­ ëˆ„ë½ ì—†ìŒ (100% coverage)
- [ ] E2E í…ŒìŠ¤íŠ¸ í†µê³¼ (ì–¸ì–´ ì „í™˜ ê²€ì¦)
- [ ] TDD Red-Green-Refactor ì‚¬ì´í´ ì¤€ìˆ˜

### Documentation
- [ ] `docs/operators/deployment/README.md` ì—…ë°ì´íŠ¸ (i18n ì„¤ì •)
- [ ] `extension/README.md` ì—…ë°ì´íŠ¸ (ì–¸ì–´ ì„¤ì • ê°€ì´ë“œ)
- [ ] ë²ˆì—­ ê¸°ì—¬ ê°€ì´ë“œ ì‘ì„± (ìƒˆ ì–¸ì–´ ì¶”ê°€ ë°©ë²•)
- [ ] ADR ì‘ì„± (i18n ì „ëµ, ë²ˆì—­ íŒŒì¼ í¬ë§· ì„ íƒ)

---

## Future Enhancements

**ì¶”ê°€ ì–¸ì–´ ì§€ì›:**
- Japanese (æ—¥æœ¬èª)
- Chinese Simplified (ç®€ä½“ä¸­æ–‡)

**ê³ ê¸‰ ê¸°ëŠ¥:**
- ë³µìˆ˜í˜• ì§€ì› (i18next plurals)
- ë‚ ì§œ/ìˆ«ì í¬ë§·íŒ… (locale-aware)
- RTL (Right-to-Left) ì–¸ì–´ ì§€ì› (Arabic, Hebrew)

**ë²ˆì—­ ê´€ë¦¬:**
- Crowdin/Transifex í†µí•© (ë²ˆì—­ ê¸°ì—¬ í”Œë«í¼)
- ìë™ ë²ˆì—­ ê²€ì¦ (missing keys, unused keys)

---

## Related Plans

- **Plan 07**: Hybrid-Dual Architecture (ì„ í–‰ ì¡°ê±´)
- **Plan 09**: Dynamic Configuration (ë…ë¦½ì , ë³‘ë ¬ ê°€ëŠ¥)
- **Plan 10**: stdio Transport (ë…ë¦½ì , ë³‘ë ¬ ê°€ëŠ¥)
- **Plan 11**: MCP App UI Rendering (ë…ë¦½ì , ë³‘ë ¬ ê°€ëŠ¥)
- **Plan 12**: Vector Search (ë…ë¦½ì , ë³‘ë ¬ ê°€ëŠ¥)

---

*Draft Created: 2026-02-07*
*Reference: _archive/migration/20260204/plans/phase7/backup-20260203/phase7.0-original.md (Step 13-14)*
*Next: Plan ìŠ¹ì¸ í›„ Phase ìƒì„¸ ê³„íš ì‘ì„±*
