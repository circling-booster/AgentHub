# Claude Code Hooks ìµœì í™” ê°€ì´ë“œ

> **ëª©ì :** í† í° ë¹„ìš© ìµœì†Œí™” + í”„ë¡œì íŠ¸ ì•ˆì •ì„± ìœ ì§€

**ì‘ì„±ì¼:** 2026-01-30
**ê¸°ë°˜:** Reddit í† í° ìµœì í™” ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤ ë¶„ì„

---

## ğŸ“Š ë¬¸ì œ ë¶„ì„

### í† í° ë¹„ìš©ì´ ë°œìƒí•˜ëŠ” ì§€ì 

Claude CodeëŠ” **ì»¨í…ìŠ¤íŠ¸ í¬ê¸°**ì— ë¹„ë¡€í•´ í† í°ì„ ì†Œë¹„í•©ë‹ˆë‹¤:

```
ì»¨í…ìŠ¤íŠ¸ = ëŒ€í™” íˆìŠ¤í† ë¦¬ + ë„êµ¬ ì¶œë ¥ + íŒŒì¼ ë‚´ìš©
â†’ ì»¨í…ìŠ¤íŠ¸ â†‘ = ë§¤ í„´ë§ˆë‹¤ ì…ë ¥ í† í° â†‘ = ë¹„ìš© â†‘
```

**Hook ì¶œë ¥ì´ ì»¨í…ìŠ¤íŠ¸ì— ëˆ„ì **ë˜ë¯€ë¡œ, ê¸´ ë¡œê·¸ë¥¼ ë°˜ë³µ ìƒì„±í•˜ë©´ ë¹„ìš©ì´ ê¸°í•˜ê¸‰ìˆ˜ì ìœ¼ë¡œ ì¦ê°€í•©ë‹ˆë‹¤.

### í˜„ì¬ ì„¤ì •ì˜ ë¹„ìš© ì˜í–¥

| Hook | ì‹¤í–‰ ì‹œì  | ì¶œë ¥ëŸ‰ | ë¹„ìš© ì˜í–¥ | í‰ê°€ |
|------|----------|:-----:|:--------:|:----:|
| PostToolUse (ruff) | ë§¤ Edit/Write | ìµœì†Œ (--quiet) | ğŸŸ¢ ë‚®ìŒ | âœ… ì´ë¯¸ ìµœì í™”ë¨ |
| Stop (pytest unit) | ì‘ë‹µ ì™„ë£Œ ì‹œ | ì œí•œ (head -20) | ğŸŸ¡ ì¤‘ê°„ | âœ… ì´ë¯¸ ìµœì í™”ë¨ |
| **UserPromptSubmit** | commit/pr/push ëª…ë ¹ | **ë§¤ìš° í¼** | ğŸ”´ **ë†’ìŒ** | âŒ **ìµœëŒ€ ë¬¸ì œ** |
| SessionEnd | ì„¸ì…˜ ì¢…ë£Œ | ìµœì†Œ | ğŸŸ¢ ë‚®ìŒ | âœ… ë¬¸ì œì—†ìŒ |

**í•µì‹¬ ë¬¸ì œ: UserPromptSubmitì˜ ì „ì²´ í…ŒìŠ¤íŠ¸+ì»¤ë²„ë¦¬ì§€**

```bash
# í˜„ì¬ ì„¤ì •
pytest tests/ --cov=src --cov-fail-under=80 -q
# â†’ 262 tests, ìˆ˜ì‹­ ì´ˆ ì†Œìš”, ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸ ìˆ˜ë°± ë¼ì¸
```

**ë¹„ìš© í­ë°œ ì‹œë‚˜ë¦¬ì˜¤:**
1. ì‚¬ìš©ì: "commit this"
2. pytest 262ê°œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ â†’ ì¶œë ¥ ìˆ˜ë°±~ìˆ˜ì²œ ë¼ì¸
3. ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸ â†’ íŒŒì¼ë³„ ì»¤ë²„ë¦¬ì§€ í‘œ
4. ì´ ì¶œë ¥ì´ ì»¨í…ìŠ¤íŠ¸ì— ëˆ„ì  â†’ ë‹¤ìŒ í„´ì˜ ì…ë ¥ í† í° ì¦ê°€
5. ì‹¤íŒ¨ ì‹œ ë°˜ë³µ â†’ ë¡œê·¸ ëˆ„ì  â†’ ì»¨í…ìŠ¤íŠ¸ í­ë°œ ğŸ’¥

---

## ğŸ¯ ìµœì í™” ì „ëµ

### 3ë‹¨ê³„ ë°©ì–´ì„ 

```
Level 1 (ë¡œì»¬ ê°œë°œ): ë¹ ë¥¸ í”¼ë“œë°±, ìµœì†Œ ì¶œë ¥
  â†“
Level 2 (ë¡œì»¬ ì»¤ë°‹): ìŠ¤ë§ˆíŠ¸ ê²€ì¦, ì¡°ê±´ë¶€ ì‹¤í–‰
  â†“
Level 3 (CI): ì „ì²´ ê²€ì¦, ë³‘ë ¬ ì‹¤í–‰
```

**ì›ì¹™:**
- **ê°œë°œ ì¤‘:** ë¹ ë¥¸ í”¼ë“œë°± ìš°ì„  (unit testsë§Œ)
- **ì»¤ë°‹ ì „:** ìŠ¤ë§ˆíŠ¸ ê²€ì¦ (ë³€ê²½ íŒŒì¼ ê¸°ë°˜)
- **PR/CI:** ì „ì²´ ê²€ì¦ (í’ˆì§ˆ ë³´ì¦)

---

## ğŸ“¦ ì œê³µë˜ëŠ” ê°œì„ ì•ˆ

3ê°€ì§€ ì„¤ì • íŒŒì¼ì„ ì œê³µí•©ë‹ˆë‹¤. í”„ë¡œì íŠ¸ ìƒí™©ì— ë§ì¶° ì„ íƒí•˜ì„¸ìš”:

| ì„¤ì • íŒŒì¼ | ì „ëµ | í† í° ì ˆê° | í’ˆì§ˆ ë³´ì¥ | ì¶”ì²œ ëŒ€ìƒ |
|----------|------|:--------:|:--------:|----------|
| `settings_optimized.json` | ì¶œë ¥ ìµœì†Œí™” | â­â­â­ | â­â­â­â­â­ | **ê· í˜•í˜•** (ê¶Œì¥) |
| `settings_smart.json` | ì¡°ê±´ë¶€ ì‹¤í–‰ | â­â­â­â­â­ | â­â­â­â­ | ë¹ ë¥¸ ê°œë°œ |
| `settings_minimal.json` | CI ì˜ì¡´ | â­â­â­â­â­ | â­â­â­ | ê·¹ë‹¨ì  ìµœì í™” |

---

## ğŸ“‹ ê°œì„ ì•ˆ ìƒì„¸

### Option A: ì¶œë ¥ ìµœì†Œí™” (â­ ê¶Œì¥)

**íŒŒì¼:** `.claude/settings_optimized.json`

**ë³€ê²½ì‚¬í•­:**

```diff
"UserPromptSubmit": [
  {
    "matcher": "commit|pr|push",
    "hooks": [
      {
        "description": "Pre-commit: Quick lint check",
-       "command": "ruff check src/ tests/ --fix && ruff format src/ tests/"
+       "command": "ruff check src/ tests/ --fix --quiet 2>&1 | head -10; ruff format src/ tests/ --quiet 2>&1 | head -10"
      },
      {
        "description": "Pre-commit: Changed files only + coverage summary",
-       "command": "pytest tests/ --cov=src --cov-fail-under=80 -q"
+       "command": "git diff --name-only --cached | grep -E '\\.py$' | xargs -r pytest --cov=src --cov-report=term-missing:skip-covered -q --tb=line 2>&1 | grep -E '^(PASSED|FAILED|ERROR|coverage:)' | head -30"
      }
    ]
  }
]
```

**íš¨ê³¼:**
- ruff ì¶œë ¥: ë¬´ì œí•œ â†’ ìµœëŒ€ 10ë¼ì¸
- pytest ì¶œë ¥: ìˆ˜ë°± ë¼ì¸ â†’ ìµœëŒ€ 30ë¼ì¸
- **í† í° ì ˆê°: ì•½ 80%**

**ì¥ì :**
- ì¦‰ì‹œ ì ìš© ê°€ëŠ¥ (ìŠ¤í¬ë¦½íŠ¸ ë¶ˆí•„ìš”)
- í”„ë¡œì íŠ¸ í’ˆì§ˆ ì •ì±… ìœ ì§€ (80% ì»¤ë²„ë¦¬ì§€)
- ì‹¤íŒ¨ ì‹œ í•µì‹¬ ì •ë³´ë§Œ í‘œì‹œ

**ë‹¨ì :**
- ì—¬ì „íˆ ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (ì‹œê°„ ì†Œìš”)

**ì ìš© ë°©ë²•:**

```bash
# í˜„ì¬ ì„¤ì • ë°±ì—…
cp .claude/settings.json .claude/settings.json.bak

# ìµœì í™” ì„¤ì • ì ìš©
cp .claude/settings_optimized.json .claude/settings.json

# Claude Code ì¬ì‹œì‘ ë˜ëŠ” ì„¤ì • ë¦¬ë¡œë“œ
```

---

### Option B: ìŠ¤ë§ˆíŠ¸ í…ŒìŠ¤íŠ¸ (ë¹ ë¥¸ ê°œë°œ)

**íŒŒì¼:** `.claude/settings_smart.json` + `scripts/smart_test.sh`

**ì „ëµ:**
- ë³€ê²½ íŒŒì¼ ë¶„ì„ â†’ í…ŒìŠ¤íŠ¸ ë²”ìœ„ ìë™ ì¡°ì •
- `src/` ë³€ê²½ ì‹œ: ì „ì²´ í…ŒìŠ¤íŠ¸ (ì¶œë ¥ ìµœì†Œí™”)
- `tests/` ë˜ëŠ” `docs/` ë³€ê²½ ì‹œ: ê´€ë ¨ í…ŒìŠ¤íŠ¸ë§Œ
- Python íŒŒì¼ ì—†ìœ¼ë©´: ìŠ¤í‚µ

**smart_test.sh ë¡œì§:**

```bash
# Git diffë¡œ ë³€ê²½ íŒŒì¼ í™•ì¸
CHANGED_FILES=$(git diff --name-only --cached | grep -E '\.py$')

if src/ ë³€ê²½:
    # ì „ì²´ í…ŒìŠ¤íŠ¸ (ì¶œë ¥ ìµœì†Œí™”)
    pytest tests/ --cov=src --cov-fail-under=80 \
        --cov-report=term-missing:skip-covered -q --tb=line \
        2>&1 | grep -E '^(tests/|PASSED|FAILED|ERROR|coverage:)' | head -50
elif tests/ ë³€ê²½:
    # ë³€ê²½ëœ í…ŒìŠ¤íŠ¸ íŒŒì¼ë§Œ
    pytest $CHANGED_TEST_FILES -q --tb=line | head -30
else:
    # ìŠ¤í‚µ
    echo "No Python files changed"
fi
```

**íš¨ê³¼:**
- docs ìˆ˜ì • ì‹œ: í…ŒìŠ¤íŠ¸ ìŠ¤í‚µ (í† í° 0)
- tests ìˆ˜ì • ì‹œ: ê´€ë ¨ í…ŒìŠ¤íŠ¸ë§Œ (í† í° 50% ì ˆê°)
- src ìˆ˜ì • ì‹œ: ì „ì²´ í…ŒìŠ¤íŠ¸ (ì¶œë ¥ ìµœì†Œí™”ë¡œ 80% ì ˆê°)

**ì¥ì :**
- ê°€ì¥ ë¹ ë¥¸ í”¼ë“œë°±
- ìµœëŒ€ í† í° ì ˆê°
- ê°œë°œ ì†ë„ í–¥ìƒ

**ë‹¨ì :**
- Bash ìŠ¤í¬ë¦½íŠ¸ í•„ìš” (Windowsì—ì„œ Git Bash ë˜ëŠ” WSL í•„ìš”)
- CI ì˜ì¡´ë„ ì¦ê°€

**ì ìš© ë°©ë²•:**

```bash
# ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬ (Linux/Mac)
chmod +x scripts/smart_test.sh

# ì„¤ì • ì ìš©
cp .claude/settings_smart.json .claude/settings.json
```

---

### Option C: CI ì˜ì¡´í˜• (ê·¹ë‹¨ì  ìµœì í™”)

**íŒŒì¼:** `.claude/settings_minimal.json`

**ì „ëµ:**
- ë¡œì»¬: Lintë§Œ ì‹¤í–‰ (ruff check/format)
- í…ŒìŠ¤íŠ¸: CIì—ì„œë§Œ ì‹¤í–‰
- ì»¤ë°‹ ì†ë„ ìµœìš°ì„ 

**íš¨ê³¼:**
- UserPromptSubmit ì¶œë ¥: ìµœëŒ€ 20ë¼ì¸
- í…ŒìŠ¤íŠ¸ ì‹¤í–‰: 0ì´ˆ
- **í† í° ì ˆê°: ì•½ 95%**

**ì¥ì :**
- ìµœëŒ€ í† í° ì ˆê°
- ë¹ ë¥¸ ì»¤ë°‹ ì›Œí¬í”Œë¡œìš°

**ë‹¨ì :**
- ë¡œì»¬ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ë¥¼ ì»¤ë°‹ ì „ì— ë°œê²¬ ëª»í•¨
- CI ì˜ì¡´ë„ 100% (CI ì‹¤íŒ¨ ì‹œ revert í•„ìš”)

**ì ìš© ëŒ€ìƒ:**
- CIê°€ ë¹ ë¥´ê³  ì•ˆì •ì ì¸ í”„ë¡œì íŠ¸
- í† í° ë¹„ìš©ì´ ê·¹ë„ë¡œ ì¤‘ìš”í•œ ê²½ìš°
- ìˆ™ë ¨ëœ ê°œë°œì (í…ŒìŠ¤íŠ¸ ì§ê´€)

**ì ìš© ë°©ë²•:**

```bash
cp .claude/settings_minimal.json .claude/settings.json
```

---

## ğŸ” ë¹„êµí‘œ

| í•­ëª© | í˜„ì¬ | Optimized | Smart | Minimal |
|------|:----:|:---------:|:-----:|:-------:|
| **UserPromptSubmit ì¶œë ¥** | ìˆ˜ë°± ë¼ì¸ | ~30 ë¼ì¸ | 0~50 ë¼ì¸ | ~20 ë¼ì¸ |
| **ì‹¤í–‰ ì‹œê°„** | 20-30ì´ˆ | 20-30ì´ˆ | 0-30ì´ˆ | 2-5ì´ˆ |
| **í† í° ì ˆê°** | ê¸°ì¤€ | 80% | 90% | 95% |
| **ë¡œì»¬ í’ˆì§ˆ ë³´ì¥** | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | â­â­â­ |
| **CI ì˜ì¡´ë„** | ë‚®ìŒ | ë‚®ìŒ | ì¤‘ê°„ | ë†’ìŒ |
| **ì ìš© ë‚œì´ë„** | - | ì‰¬ì›€ | ì¤‘ê°„ | ì‰¬ì›€ |
| **ì¶”ì²œ ëŒ€ìƒ** | - | **ëŒ€ë¶€ë¶„** | ë¹ ë¥¸ ê°œë°œ | ìˆ™ë ¨ì |

---

## ğŸ“Œ ê¶Œì¥ ì ìš© ìˆœì„œ

### 1ë‹¨ê³„: Optimized ì ìš© (ì¦‰ì‹œ)

```bash
cp .claude/settings_optimized.json .claude/settings.json
```

**ì´ìœ :**
- ì¦‰ì‹œ 80% í† í° ì ˆê°
- í”„ë¡œì íŠ¸ ì•ˆì •ì„± ìœ ì§€
- ì¶”ê°€ ì‘ì—… ë¶ˆí•„ìš”

### 2ë‹¨ê³„: íš¨ê³¼ ì¸¡ì • (1-2ì£¼)

```bash
# ì„¸ì…˜ë§ˆë‹¤ í† í° ì‚¬ìš©ëŸ‰ í™•ì¸
/stats

# ë˜ëŠ” API ì‚¬ìš©ìì˜ ê²½ìš°
/cost
```

**ê¸°ì¤€:**
- Optimizedë¡œ ì¶©ë¶„í•˜ë©´ ìœ ì§€
- ì—¬ì „íˆ ë¹„ìš© ë¶€ë‹´ì´ë©´ 3ë‹¨ê³„ë¡œ

### 3ë‹¨ê³„: Smart ë˜ëŠ” Minimal ì ìš© (ì„ íƒì )

**Smart ì„ íƒ ì¡°ê±´:**
- Git Bash ë˜ëŠ” WSL ì‚¬ìš© ê°€ëŠ¥
- ê°œë°œ ì†ë„ê°€ ì¤‘ìš”
- CIê°€ ì•ˆì •ì 

**Minimal ì„ íƒ ì¡°ê±´:**
- í† í° ë¹„ìš©ì´ ê·¹ë„ë¡œ ì¤‘ìš”
- CIê°€ ë¹ ë¥´ê³  ì‹ ë¢° ê°€ëŠ¥
- ë¡œì»¬ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ìˆ˜ìš© ê°€ëŠ¥

---

## ğŸ”§ ì¶”ê°€ ìµœì í™” íŒ

### 1. ì¶œë ¥ í•„í„°ë§ íŒ¨í„´

```bash
# ERRORë§Œ í‘œì‹œ
command 2>&1 | grep -E '^ERROR' | head -10

# ìš”ì•½ë§Œ í‘œì‹œ
pytest tests/ -q 2>&1 | grep -E '^(PASSED|FAILED|====)' | head -20

# íŠ¹ì • íŒŒì¼ ì œì™¸
pytest tests/ --ignore=tests/integration/ -q
```

### 2. pytest ì˜µì…˜ ì¡°í•©

```bash
# ìµœì†Œ ì¶œë ¥ + ë¹ ë¥¸ ì‹¤íŒ¨
pytest -q --tb=line --maxfail=1

# ì»¤ë²„ë¦¬ì§€ ìš”ì•½ë§Œ
pytest --cov=src --cov-report=term-missing:skip-covered

# ë³€ê²½ íŒŒì¼ë§Œ í…ŒìŠ¤íŠ¸ (pytest-testmon)
pytest --testmon
```

### 3. Hook ì¶œë ¥ ë””ë²„ê¹…

```bash
# Hook ì¶œë ¥ì„ íŒŒì¼ë¡œ ì €ì¥
command 2>&1 | tee hook_output.log | head -20

# í† í° ì˜ˆìƒì¹˜ ê³„ì‚° (ëŒ€ëµ 1 token = 4 characters)
wc -c hook_output.log  # characters / 4 â‰ˆ tokens
```

---

## ğŸš¨ ì£¼ì˜ì‚¬í•­

### í”„ë¡œì íŠ¸ ì •ì±…ê³¼ì˜ ê· í˜•

AgentHub í”„ë¡œì íŠ¸ëŠ”:
- âœ… TDD ê°•ì¡° (í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ 80% í•„ìˆ˜)
- âœ… CIì—ì„œ ìµœì¢… í’ˆì§ˆ ê²€ì¦
- âœ… GitHub Actionsê°€ PR ì°¨ë‹¨ (coverage < 80%)

**ì•ˆì „í•œ ìµœì í™”:**
- ë¡œì»¬ Hookì€ ì¶œë ¥ë§Œ ìµœì†Œí™”
- CIëŠ” ë³€ê²½í•˜ì§€ ì•ŠìŒ (ì „ì²´ ê²€ì¦ ìœ ì§€)
- ë¡œì»¬ ì‹¤íŒ¨ë¥¼ CIê°€ ë‹¤ì‹œ ì¡ìŒ (2ì¤‘ ì•ˆì „ë§)

### Windows í™˜ê²½ ê³ ë ¤

**Option B (smart_test.sh) ì‚¬ìš© ì‹œ:**

```bash
# Git Bashì—ì„œ ì‹¤í–‰ (Git for Windows í¬í•¨)
bash scripts/smart_test.sh

# ë˜ëŠ” WSL ì‚¬ìš©
wsl bash scripts/smart_test.sh

# PowerShell ëŒ€ì•ˆ (ë³„ë„ êµ¬í˜„ í•„ìš”)
pwsh scripts/smart_test.ps1
```

---

## ğŸ“š ì°¸ê³  ìë£Œ

- [Reddit: Claude Code Token Waste Discussion](https://www.reddit.com/r/ClaudeAI/comments/1qhvfao/am_i_the_only_one_wasting_tons_of_tokens_due_to/)
- [Claude Code Hooks Documentation](https://code.claude.com/docs/hooks)
- [pytest Output Control](https://docs.pytest.org/en/stable/how-to/output.html)
- [ruff Configuration](https://docs.astral.sh/ruff/configuration/)

---

## ğŸ¯ ìš”ì•½ ë° ì¶”ì²œ

### TL;DR

| ìƒí™© | ì¶”ì²œ ì„¤ì • | ì˜ˆìƒ íš¨ê³¼ |
|------|----------|----------|
| **ëŒ€ë¶€ë¶„ì˜ ê²½ìš°** | `settings_optimized.json` | 80% í† í° ì ˆê°, ì•ˆì •ì„± ìœ ì§€ |
| ë¹ ë¥¸ ê°œë°œì´ ì¤‘ìš” | `settings_smart.json` | 90% í† í° ì ˆê°, Git Bash í•„ìš” |
| í† í° ë¹„ìš© ê·¹í•œ ìµœì í™” | `settings_minimal.json` | 95% í† í° ì ˆê°, CI ì˜ì¡´ |

### ì¦‰ì‹œ í–‰ë™ (3ë¶„ ì•ˆì—)

```bash
# 1. í˜„ì¬ ì„¤ì • ë°±ì—…
cp .claude/settings.json .claude/settings.json.bak

# 2. ìµœì í™” ì„¤ì • ì ìš©
cp .claude/settings_optimized.json .claude/settings.json

# 3. ì™„ë£Œ!
# Claude Codeê°€ ìë™ìœ¼ë¡œ ìƒˆ ì„¤ì • ë¡œë“œ
```

**ì˜ˆìƒ ê²°ê³¼:**
- commit/pr/push ëª…ë ¹ ì‹œ ì¶œë ¥: ìˆ˜ë°± ë¼ì¸ â†’ 30-50 ë¼ì¸
- ì»¨í…ìŠ¤íŠ¸ í¬ê¸°: 80% ê°ì†Œ
- ì›” í† í° ë¹„ìš©: 80% ì ˆê° (êµ¬ë… ì‚¬ìš©ì: usage ê°ì†Œ)

---

*ë¬¸ì„œ ì‘ì„±ì¼: 2026-01-30*
*ê¸°ë°˜: Reddit ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤ + í”„ë¡œì íŠ¸ í˜„í™© ë¶„ì„*
